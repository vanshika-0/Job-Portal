<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apply Job</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body style="background:#E8F5DB; padding:30px;">

<div class="container p-4 bg-white shadow rounded" style="max-width:600px;">
    <h2>Apply for Job</h2>

    <p id="job-title" class="fs-4"></p>
    <p id="job-company" class="text-muted"></p>

    <label class="mt-3 fw-bold">First Name *</label>
    <input id="fname" class="form-control">

    <label class="mt-3 fw-bold">Last Name *</label>
    <input id="lname" class="form-control">

    <label class="mt-3 fw-bold">Phone *</label>
    <input id="phone" class="form-control">

    <button class="btn btn-success w-100 mt-4" onclick="applyJob()">Apply Now</button>
</div>

<script>
    // -------------------------
    // 1. GET jobId from localStorage
    // -------------------------
    const jobId = localStorage.getItem("jobId");
    const userId = 1; // fixed user until login works

    if (!jobId) {
        alert("‚ùå ERROR: jobId missing!");
    }

    // -------------------------
    // 2. Load job details
    // -------------------------
    fetch(`http://localhost:8080/api/jobs/${jobId}`)
        .then(r => r.json())
        .then(job => {
            document.getElementById("job-title").innerText = job.title;
            document.getElementById("job-company").innerText = job.company;
        })
        .catch(err => {
            console.error(err);
            alert("Failed to load job details");
        });

    // -------------------------
    // 3. APPLY JOB
    // -------------------------
    function applyJob() {

        fetch("http://localhost:8080/api/applications", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                userId: userId,
                jobId: jobId
            })
        })
        .then(res => res.json())
        .then(data => {
            alert("üéâ Application submitted successfully!");
        })
        .catch(err => {
            console.error("APPLY ERROR:", err);
            alert("‚ùå Error applying for job");
        });
    }
</script>

</body>
</html>
